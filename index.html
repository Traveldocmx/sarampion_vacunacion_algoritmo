<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>¿Se recomienda vacunación contra sarampión?</title>
  <style>
    :root{
      /* Product-style (light) */
      --bg: #eff4fb;
      --card: #ffffff;
      --stroke: #d9e2f0;
      --text: #0b1220;
      --muted: #1f2937;
      --muted2: #475569;
      --accent: #2563eb;
      --accent2: #16a34a;
      --warn: #d97706;
      --shadow: 0 22px 70px rgba(2,6,23,0.10);
      --shadow2: 0 10px 26px rgba(2,6,23,0.08);
      --radius: 18px;
      --btn: #ffffff;
      --btnH: #f1f5f9;
      --focus: 0 0 0 4px rgba(37,99,235,0.20);
      --maxw: 980px;
    }

    *{ box-sizing: border-box; }

    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(900px 500px at 12% 0%, rgba(37,99,235,0.14), transparent 62%),
        radial-gradient(900px 500px at 92% 18%, rgba(22,163,74,0.10), transparent 58%),
        radial-gradient(900px 500px at 70% 120%, rgba(217,119,6,0.08), transparent 60%),
        linear-gradient(180deg, #ffffff 0%, var(--bg) 60%, #ffffff 125%);
      min-height: 100vh;
    }

    a{ color: var(--accent); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 34px 18px 42px;
    }

    header{
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 14px;
      padding: 6px 0 18px;
    }

    .brand{ display:flex; align-items:flex-start; gap:14px; min-width:0; }

    .logo{
      width: 44px; height: 44px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(37,99,235,1), rgba(22,163,74,0.85));
      box-shadow: 0 14px 26px rgba(2,6,23,0.12);
      position: relative; overflow: hidden; flex: 0 0 auto;
    }

    .logo:before{
      content: "";
      position: absolute; inset: -35%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.70), transparent 45%);
      transform: rotate(18deg);
      opacity: 0.65;
    }

    .brand h1{ font-size: 18px; margin: 0; font-weight: 760; line-height: 1.25; letter-spacing: .2px; }
    .brand p{ margin: 6px 0 0; font-size: 13px; color: var(--muted2); line-height: 1.35; }

    .pill{
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 12px; border-radius: 999px;
      background: #ffffff;
      border: 1px solid var(--stroke);
      color: var(--muted);
      font-size: 13px; cursor: pointer; user-select: none;
      transition: transform 0.05s ease, background 0.15s ease, border-color 0.15s ease;
      box-shadow: 0 8px 18px rgba(2,6,23,0.06);
    }

    .pill:hover{ background: #f8fafc; border-color: #cbd5e1; }
    .pill:active{ transform: translateY(1px); }
    .pill:focus{ outline: none; box-shadow: var(--focus); }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .topline{
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; padding: 18px 22px;
      border-bottom: 1px solid var(--stroke);
      background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
    }

    .progress{
      width: 100%; height: 8px; border-radius: 999px;
      background: #eef2ff;
      overflow: hidden;
      border: 1px solid #dbeafe;
    }

    .bar{
      height: 100%; width: 0%; border-radius: 999px;
      background: linear-gradient(90deg, rgba(37,99,235,1), rgba(22,163,74,0.85));
      transition: width 0.35s ease;
    }

    .meta{ display:flex; flex-direction:column; gap:4px; min-width:150px; text-align:right; }
    .meta .step{ font-size: 13px; color: var(--muted); font-weight: 650; }
    .meta .hint{ font-size: 12px; color: var(--muted2); }

    .card-inner{ padding: 30px 22px 26px; }

    .screen{
      display:none;
      animation: fadeIn 0.18s ease;
      max-width: 780px;
      margin: 0 auto;
    }

    .screen.active{ display:block; }

    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    h2{ margin:0 0 10px; font-size: 28px; letter-spacing: .2px; line-height: 1.15; }

    .sub{
      margin:0 0 18px;
      color: var(--muted);
      line-height:1.72;
      font-size:15px;
      font-weight: 430;
    }

    .sub strong, .sub b{ font-weight: 760; }

    .sub + .sub{ margin-top: -6px; }

    .grid{ display:grid; gap:12px; }

    @media (min-width: 900px){
      .grid.cols2{ grid-template-columns: 1fr 1fr; }
      .grid.cols3{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .btn{
      width:100%;
      display:inline-flex;
      align-items:center;
      justify-content: space-between;
      gap:14px;
      padding:16px 16px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: var(--btn);
      color: var(--text);
      cursor:pointer;
      transition: background 0.18s ease, transform 0.05s ease, border-color 0.18s ease, box-shadow 0.18s ease;
      text-align:left;
      font-size: 15px;
      line-height: 1.25;
      user-select:none;
      box-shadow: var(--shadow2);
    }

    .btn:hover{ background: var(--btnH); border-color: #cbd5e1; }
    .btn:active{ transform: translateY(1px); }
    .btn:focus{ outline:none; box-shadow: var(--focus); }

    .btn .k{ display:flex; flex-direction:column; gap:4px; }
    .btn .k strong{ font-weight:760; }
    .btn .k span{ color: var(--muted2); font-size:13px; line-height: 1.35; }

    .chev{
      flex:0 0 auto;
      width: 32px; height: 32px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: #eef2ff;
      border: 1px solid #dbeafe;
      color: rgba(15,23,42,0.72);
      font-size: 16px;
    }

    .primary{
      background: linear-gradient(135deg, rgba(37,99,235,1), rgba(29,78,216,1));
      border-color: rgba(37,99,235,0.45);
      color: #ffffff;
    }

    .primary .k span{ color: rgba(255,255,255,0.90); }
    .primary .chev{ background: rgba(255,255,255,0.18); border-color: rgba(255,255,255,0.22); color: rgba(255,255,255,0.95); }
    .primary:hover{
      filter: brightness(1.03);
      /* ✅ Evita que “desaparezca” en algunos navegadores al aplicar filtros */
      opacity: 1;
    }

    /* ✅ Hover específico para botones azules: asegura contraste y legibilidad */
    .btn.primary:hover{
      background: linear-gradient(135deg, rgba(37,99,235,1), rgba(29,78,216,1));
      border-color: rgba(37,99,235,0.55);
      color: #ffffff;
      box-shadow: 0 14px 32px rgba(2,6,23,0.12);
    }

    .btn.primary:hover .k span{ color: rgba(255,255,255,0.92); }
    .btn.primary:hover .chev{ background: rgba(255,255,255,0.22); border-color: rgba(255,255,255,0.26); color: rgba(255,255,255,0.98); }

    .footer{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      padding: 16px 22px;
      border-top: 1px solid var(--stroke);
      background: #fbfdff;
      flex-wrap: wrap;
    }

    .navbtn{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: #ffffff;
      color: var(--text);
      cursor:pointer;
      transition: background 0.18s ease, transform 0.05s ease, border-color 0.18s ease;
      font-size: 13px;
      user-select:none;
      box-shadow: 0 8px 18px rgba(2,6,23,0.06);
    }

    .navbtn:hover{ background: #f8fafc; border-color: #cbd5e1; }
    .navbtn:active{ transform: translateY(1px); }
    .navbtn:focus{ outline:none; box-shadow: var(--focus); }

    .navbtn.secondary{ background: transparent; box-shadow:none; }
    .navbtn.secondary:hover{ background: #f8fafc; }

    .small{ font-size:12px; color: var(--muted2); line-height:1.6; }

    .result{ display:grid; gap:14px; }

    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      width: fit-content;
      font-size: 12px;
      color: var(--muted);
      font-weight: 650;
    }

    .badge.ok{ background: #ecfdf5; border-color: #bbf7d0; }
    .badge.warn{ background: #fff7ed; border-color: #fed7aa; }

    .badge .dot{
      width: 12px; height: 12px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow:
        0 0 0 5px rgba(37,99,235,0.18),
        inset 0 0 0 1px rgba(15,23,42,0.12);
    }

    .badge.ok .dot{
      background: var(--accent2);
      box-shadow:
        0 0 0 5px rgba(22,163,74,0.18),
        inset 0 0 0 1px rgba(15,23,42,0.10);
    }

    .badge.warn .dot{
      background: var(--warn);
      box-shadow:
        0 0 0 5px rgba(217,119,6,0.18),
        inset 0 0 0 1px rgba(15,23,42,0.10);
    }

    .result-card{
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: #ffffff;
      padding: 16px;
      display:grid; gap:10px;
    }

    .result-card h3{ margin:0; font-size:18px; letter-spacing:.2px; }
    .result-card p{ margin:0; color: var(--muted); line-height:1.6; font-size:15px; }

    .result-note{
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid #c7d2fe;
      border-left: 6px solid rgba(37,99,235,0.75);
      background: #ffffff;
      color: #0f172a;
      font-size: 13.5px;
      line-height: 1.7;
      box-shadow: 0 10px 22px rgba(2,6,23,0.06);
    }

    /* ✅ FIX: bloque de autoría y referencias (antes estaba en blanco sobre fondo claro) */
    .credits{
      margin: 14px 0 0;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,0.78);
      box-shadow: 0 10px 22px rgba(2,6,23,0.05);
      color: var(--muted);
      font-size: 11.5px;      /* ✅ más pequeño */
      line-height: 1.5;       /* ✅ más compacto */
    }

    .credits .title{
      font-weight: 760;
      color: var(--text);
      font-size: 12px;        /* ✅ título más pequeño */
    }

    .credits .muted{ color: var(--muted2); }

    .credits a{ color: var(--accent); }
    .credits a:hover{ text-decoration: underline; }

    .credits .title{
      font-weight: 760;
      color: var(--text);
    }

    .credits a{ color: var(--accent); }
    .credits a:hover{ text-decoration: underline; }

    .credits .muted{ color: var(--muted2); }

    @media (max-width: 520px){
      .topline{ padding: 16px 16px; }
      .card-inner{ padding: 24px 16px 22px; }
      h2{ font-size: 26px; }
      .meta{ min-width: 120px; }
    }

    @media print{
      body{ background: white; color: #0b1220; }
      header, .footer, .pill{ display:none !important; }
      .card{ box-shadow:none; border: 1px solid #e5e7eb; }
      .topline{ background: transparent; }
      .result-note, .result-card{ background: white; border-color: #e5e7eb; }
      .badge{ border-color: #e5e7eb; background: #f9fafb; color: #111827; }
      .badge .dot{ box-shadow:none; }
      .btn{ display:none; }
      .credits{ box-shadow:none; background: white; border-color: #e5e7eb; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>¿Se recomienda vacunación contra sarampión?</h1>
          <p>Algoritmo orientativo - No sustituye consulta médica ni recomendaciones oficiales</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="pill" id="btnRestart" title="Reiniciar">Reiniciar</button>
      </div>
    </header>

    <div class="card" id="appCard">
      <div class="topline">
        <div class="progress" aria-label="Progreso">
          <div class="bar" id="progressBar"></div>
        </div>
        <div class="meta">
          <div class="step" id="stepLabel">Paso 1</div>
          <div class="hint" id="stepHint">Aviso importante</div>
        </div>
      </div>

      <div class="card-inner">
        <!-- Screen: Disclaimer (Pantalla 1) -->
        <section class="screen" id="screen-disclaimer" data-step="1" data-hint="Aviso importante">
          <h2>Aviso importante</h2>
          <p class="sub"><strong>Esta  es una guía orientativa</strong> para apoyar decisiones sobre vacunación contra sarampión. <strong>No es consejo médico</strong> y no sustituye la valoración clínica, ni las recomendaciones locales o federales.</p>
          <p class="sub" style="margin-top:-8px;">La situación epidemiológica y las recomendaciones pueden cambiar sin aviso. En caso de discrepancia, prevalece la indicación de la autoridad sanitaria y del personal de salud.</p>
          <p class="sub" style="margin-top:-8px;">Consultar a profesionales de la salud antes de decidir si existe cualquiera de los siguientes escenarios: inmunosupresión, embarazo, antecedente de reacción alérgica grave (anafilaxia) a una vacuna con componente sarampión, síntomas compatibles con infección o exposición reciente a un caso, edad menor de 6 meses, o brote en una institución (guardería, escuela, hospital, albergue).</p>
          <div class="grid cols2">
            <button class="btn" id="btnExit">
              <span class="k"><strong>Salir</strong><span>Cerrar esta página</span></span>
              <span class="chev">↗</span>
            </button>
            <button class="btn primary" data-next="screen-intro">
              <span class="k"><strong>Acepto</strong><span>Continuar</span></span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Intro -->
        <section class="screen" id="screen-intro" data-step="2" data-hint="Introducción">
          <h2>Antes de empezar</h2>
          <p class="sub">El esquema completo de vacunación contra sarampión se basa en <strong>2 dosis</strong> a lo largo de la vida. En contexto de epidemias, puede recomendarse además una <strong>“dosis cero”</strong> para niñas y niños de <strong>6 a 11 meses</strong>. Esta dosis cero <strong>no cuenta</strong> como parte del esquema regular; posteriormente debe iniciarse y completarse el esquema por edad.</p>
          <div class="result-note" style="margin: 8px 0 18px;">
            En algunos contextos, la autoridad sanitaria puede recomendar vacunación adicional en <strong>grupos prioritarios</strong> (por ejemplo, personal de salud, personal educativo y jornaleros/as agrícolas), incluso con dosis previas registradas. Es importante seguir las recomendaciones de la autoridad o acudir al centro de salud.
          </div>
          <div class="grid">
            <button class="btn primary" data-next="screen-confirmed">
              <span class="k"><strong>Iniciar evaluación</strong><span>Responder unas pocas preguntas para obtener una recomendación orientativa</span></span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Measles confirmed -->
        <section class="screen" id="screen-confirmed" data-step="3" data-hint="Antecedente de sarampión">
          <h2>Sarampión confirmado</h2>
          <p class="sub">¿Alguna vez se confirmó sarampión por laboratorio en la persona que desea vacunarse?</p>
          <div class="grid cols2">
            <button class="btn" data-answer="confirmed" data-value="yes">
              <span class="k"><strong>Sí</strong><span>Confirmado por laboratorio</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="confirmed" data-value="no_unsure">
              <span class="k"><strong>No / No estoy seguro</strong><span>Continuar con la evaluación</span></span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Outbreak -->
        <section class="screen" id="screen-outbreak" data-step="4" data-hint="Contexto epidemiológico">
          <h2>Brote o campaña</h2>
          <p class="sub">¿Hay brote o campaña de la autoridad sanitaria para vacunación contra sarampión en tu zona?</p>
          <div class="grid cols3">
            <button class="btn" data-answer="outbreak" data-value="yes">
              <span class="k"><strong>Sí</strong><span>Hay brote/campaña o recomendación vigente</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="outbreak" data-value="no">
              <span class="k"><strong>No</strong><span>No hay brote/campaña en este momento</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="outbreak" data-value="unsure">
              <span class="k"><strong>No sé</strong><span>Continuar con precaución</span></span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Age -->
        <section class="screen" id="screen-age" data-step="5" data-hint="Edad">
          <h2>Edad</h2>
          <p class="sub">¿Qué edad tiene la persona hoy?</p>
          <div class="grid cols2">
            <button class="btn" data-answer="age" data-value="0_5m">
              <span class="k"><strong>0–5 meses</strong><span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="age" data-value="6_11m">
              <span class="k"><strong>6–11 meses</strong><span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="age" data-value="12_17m">
              <span class="k"><strong>12–17 meses</strong><span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="age" data-value="18m_9y">
              <span class="k"><strong>18 meses a 9 años</strong><span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="age" data-value="10_49y">
              <span class="k"><strong>10–49 años</strong><span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="age" data-value="50p">
              <span class="k"><strong>50 años o más</strong><span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Evidence -->
        <section class="screen" id="screen-evidence" data-step="6" data-hint="Cartilla / registro">
          <h2>Evidencia de vacunación</h2>
          <p class="sub">¿Se cuenta con cartilla o un registro para confirmar cuántas dosis se han aplicado a lo largo de la vda?</p>
          <div class="grid cols2">
            <button class="btn" data-answer="evidence" data-value="yes">
              <span class="k"><strong>Sí</strong><span>Se puede confirmar con cartilla/registro</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="evidence" data-value="no_unsure">
              <span class="k"><strong>No / No estoy seguro /  No recuerdo</strong><span>No hay registro confiable</span></span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Doses documented -->
        <section class="screen" id="screen-doses" data-step="7" data-hint="Dosis registradas">
          <h2>Dosis documentadas</h2>
          <p class="sub">Según cartilla/registro, ¿cuántas dosis contra sarampión se tienen registradas en toda la vida?</p>
          <div class="grid cols3">
            <button class="btn" data-answer="doses" data-value="0">
              <span class="k"><strong>0 dosis</strong><span>Sin dosis registradas</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="doses" data-value="1">
              <span class="k"><strong>1 dosis</strong><span>Una dosis registrada</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="doses" data-value="2p">
              <span class="k"><strong>2 dosis o más</strong><span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Dose before 12 months (conditional) -->
        <section class="screen" id="screen-before12" data-step="8" data-hint="Fecha de la dosis">
          <h2>Edad al vacunarse</h2>
          <p class="sub" id="before12Prompt">Esa dosis registrada, ¿se aplicó antes de cumplir 12 meses?</p>
          <div class="grid cols3">
            <button class="btn" data-answer="before12" data-value="yes">
              <span class="k"><strong>Sí</strong><span>Antes de 12 meses (dosis cero)</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="before12" data-value="no">
              <span class="k"><strong>No</strong><span>A los 12 meses o después</span></span>
              <span class="chev">→</span>
            </button>
            <button class="btn" data-answer="before12" data-value="unsure">
              <span class="k"><strong>No lo sé</strong><span>El registro no lo aclara</span></span>
              <span class="chev">→</span>
            </button>
          </div>
        </section>

        <!-- Screen: Result -->
        <section class="screen" id="screen-result" data-step="9" data-hint="Resultado">
          <div class="result">
            <span class="badge" id="resultBadge"><span class="dot" aria-hidden="true"></span><span id="badgeText">Resultado</span></span>
            <div class="result-card">
              <h3 id="resultTitle">Resultado</h3>
              <p id="resultPrimary">—</p>
              <p id="resultSecondary">—</p>
            </div>
            <div class="result-note" id="resultNote">Nota: esta herramienta es orientativa. En caso de brote/campaña, la autoridad puede indicar acciones adicionales. Si hay duda, acudir al centro de salud con cartilla/registro.</div>
          </div>
        </section>
      </div>

      <div class="footer">
        <div class="small" id="footerSmall">Sugerencia: usar cartilla o registro cuando esté disponible.</div>
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <button class="navbtn secondary" id="btnBack">← Atrás</button>
          <button class="navbtn" id="btnHome">Inicio</button>
        </div>
      </div>
    </div>

    <!-- ✅ FIX: antes estaba con texto blanco (rgba(255,255,255,0.55)) y por eso no se leía -->
    <div class="credits" aria-label="Créditos y fuentes">
      <div class="title">TraveldocMX | Dr. Rodrigo Ville Benavides (Infectología)</div>
      <div class="muted" style="margin-top:10px;">Basado en:</div>
      <div style="margin-top:6px;">
        <a href="https://www.gob.mx/cms/uploads/attachment/file/905605/Lineamientos_de_Campan_a_de_Vacunacion_y_Recuperacion_de_Coberturas_2024_Vf.pdf" target="_blank" rel="noopener noreferrer">Lineamientos de Campaña de Vacunación y Recuperación de Coberturas 2024</a>
        · <a href="https://www.gob.mx/cms/uploads/attachment/file/977163/Lineamientos_Generales_2025_.pdf" target="_blank" rel="noopener noreferrer">Lineamientos Generales 2025</a>
        · <a href="https://educacionensalud.imss.gob.mx/ces_wp/wp-content/uploads/2025/07/INFO_IEPCS_Esquema-vacunacion_V5A.pdf" target="_blank" rel="noopener noreferrer">IMSS: Esquema de vacunación (V5A)</a>
      </div>
      <div class="muted" style="margin-top:10px;">Uso orientativo/educativo. No es publicidad y no sustituye una valoración médica ni las recomendaciones vigentes de la autoridad sanitaria (local o federal).</div>
      <div class="muted" style="margin-top:6px;">Los lineamientos pueden cambiar sin aviso; verifica la información más actualizada en canales oficiales o en tu unidad de salud.</div>
      <div class="muted" style="margin-top:10px;">Versión 1.0 | Actualizado: 2026-02-06</div>
      <div class="muted" style="margin-top:6px;">Comentarios/correcciones: <a href="mailto:dr.rodrigoville@gmail.com">dr.rodrigoville@gmail.com</a></div>
    </div>
  </div>

  <script>
  (function(){
    const MAX_STEPS = 9;

    const screens = Array.from(document.querySelectorAll('.screen'));
    const progressBar = document.getElementById('progressBar');
    const stepLabel = document.getElementById('stepLabel');
    const stepHint = document.getElementById('stepHint');

    const btnBack = document.getElementById('btnBack');
    const btnHome = document.getElementById('btnHome');
    const btnRestart = document.getElementById('btnRestart');

    const footerSmall = document.getElementById('footerSmall');

    const resultBadge = document.getElementById('resultBadge');
    const badgeText = document.getElementById('badgeText');
    const resultTitle = document.getElementById('resultTitle');
    const resultPrimary = document.getElementById('resultPrimary');
    const resultSecondary = document.getElementById('resultSecondary');
    const resultNote = document.getElementById('resultNote');

    const before12Prompt = document.getElementById('before12Prompt');

    const state = {
      confirmed: null,
      outbreak: null,
      age: null,
      evidence: null,
      doses: null,
      before12: null,
      before12Context: null
    };

    const navStack = [];

    function getScreen(id){ return document.getElementById(id); }

    function footerHintFor(id){
      if(id === 'screen-disclaimer') return 'Lee el aviso y continúa para iniciar el flujo.';
      if(id === 'screen-intro') return '';
      if(id === 'screen-confirmed') return '';
      if(id === 'screen-outbreak') return 'En brotes, la recomendación puede variar por localidad.';
      if(id === 'screen-age') return 'Selecciona el rango de edad actual.';
      if(id === 'screen-evidence') return 'La cartilla/registro mejora la precisión de la recomendación.';
      if(id === 'screen-doses') return 'Cuenta las dosis registradas contra sarampión a lo largo de la vida.';
      if(id === 'screen-before12') return 'Distinguir dosis cero (antes de 12 meses) vs esquema por edad.';
      if(id === 'screen-result') return 'Si hay duda, acudir al centro de salud con cartilla/registro.';
      return '—';
    }

    function updateTopline(id){
      const el = getScreen(id);
      const step = Number(el?.getAttribute('data-step') || 1);
      const hint = el?.getAttribute('data-hint') || '';

      stepLabel.textContent = `Paso ${step}`;
      stepHint.textContent = hint;

      const pct = Math.min(100, Math.max(0, Math.round((step / MAX_STEPS) * 100)));
      progressBar.style.width = pct + '%';

      footerSmall.textContent = footerHintFor(id);

      // Hide buttons on specific screens
      const hideBack = (id === 'screen-disclaimer');
      const hideHome = (id === 'screen-disclaimer' || id === 'screen-intro');

      btnBack.style.display = hideBack ? 'none' : '';
      btnHome.style.display = hideHome ? 'none' : '';

      btnBack.disabled = navStack.length <= 1;
      btnBack.style.opacity = btnBack.disabled ? 0.55 : 1;
    }

    function showScreen(id, mode='push'){
      screens.forEach(s => s.classList.remove('active'));
      const el = getScreen(id);
      if(!el) return;
      el.classList.add('active');

      if(mode === 'replace'){
        if(navStack.length === 0) navStack.push(id);
        else navStack[navStack.length - 1] = id;
      } else {
        if(navStack.length === 0 || navStack[navStack.length - 1] !== id) navStack.push(id);
      }

      updateTopline(id);

      try{ window.scrollTo({ top: 0, behavior: 'smooth' }); }
      catch { window.scrollTo(0,0); }
    }

    function resetState(){
      state.confirmed = null;
      state.outbreak = null;
      state.age = null;
      state.evidence = null;
      state.doses = null;
      state.before12 = null;
      state.before12Context = null;
    }

    function hardRestart(){
      resetState();
      navStack.length = 0;
      showScreen('screen-disclaimer','push');
    }

    function makeResult(kind, title, primary, secondary){
      return { kind, title, primary, secondary };
    }

    function applyResult(res){
      resultBadge.classList.remove('ok','warn');
      if(res.kind === 'ok'){
        resultBadge.classList.add('ok');
        badgeText.textContent = 'Se recomienda acción';
      } else {
        resultBadge.classList.add('warn');
        badgeText.textContent = 'Orientación';
      }

      resultTitle.textContent = res.title;
      resultPrimary.textContent = res.primary;
      resultSecondary.textContent = res.secondary;

      let note = 'Nota: esta herramienta es orientativa. En caso de brote/campaña, la estrategia local puede indicar acciones adicionales. Si hay duda, acudir al centro de salud con cartilla/registro.';
      if(state.confirmed === 'yes'){
        note = 'Nota: si hubo sarampión confirmado por laboratorio, en general no se requiere vacunación. Si existe indicación médica especial, seguir esa indicación.';
      }
      resultNote.textContent = note;
    }

    function recommendTextForNoRecord(){
      const o = state.outbreak;
      switch(state.age){
        case '0_5m':
          return makeResult('warn','Resultado','Aún no corresponde vacunación.','Revisar nuevamente al cumplir 6 meses si hay una indicación vigente por brote (dosis cero).');
        case '6_11m':
          if(o === 'yes' || o === 'unsure'){
            return makeResult('ok','Resultado','Sí se sugiere vacunación (dosis cero).','Acudir al centro de salud para valoración según recomendación vigente.');
          }
          return makeResult('warn','Resultado','En general aún no corresponde vacunación de rutina en esta edad.','Acudir al centro de salud si existe indicación especial o si cambia la recomendación vigente.');
        case '12_17m':
          return makeResult('ok','Resultado','Sí se sugiere vacunación en cuanto sea posible.','Acudir al centro de salud con cartilla (si se cuenta con ella).');
        case '18m_9y':
          if(o === 'yes' || o === 'unsure'){
            return makeResult('ok','Resultado','Sí se sugiere vacunación en cuanto sea posible.','Acudir al centro de salud con cartilla (si se cuenta con ella).');
          }
          return makeResult('ok','Resultado','Sí se sugiere vacunación si no se cuenta con esquema completo o no hay certeza.','Acudir al centro de salud con cartilla (si se cuenta con ella).');
        case '10_49y':
          return makeResult('ok','Resultado','Sí se sugiere vacunación en cuanto sea posible.','Se debe completar un esquema de 2 dosis separadas por al menos 28 días.');
        case '50p':
          return makeResult('warn','Resultado','En general no es necesario vacunarse de rutina.','Acudir a valoración médica si existe indicación especial o si hay recomendación de la autoridad sanitaria.');
        default:
          return makeResult('warn','Resultado','Información insuficiente.','Reiniciar y completar la evaluación.');
      }
    }

    function computeResult(){
      if(state.confirmed === 'yes'){
        return makeResult('warn','Resultado','No es necesario vacunarse.','Si existe una indicación médica especial o una recomendación específica de la autoridad sanitaria, seguir esa indicación.');
      }

      if(state.evidence === 'no_unsure'){
        return recommendTextForNoRecord();
      }

      const o = state.outbreak;
      const age = state.age;
      const doses = state.doses;

      if(age === '0_5m'){
        return makeResult('warn','Resultado','Aún no corresponde vacunación.','Revisar nuevamente al cumplir 6 meses si hay una indicación vigente por brote (dosis cero).');
      }

      if(age === '50p'){
        return makeResult('warn','Resultado','En general no es necesario vacunarse de rutina.','Acudir a valoración médica si existe indicación especial o si hay recomendación de la autoridad sanitaria.');
      }

      if(age === '10_49y'){
        if(doses === '0') return makeResult('ok','Resultado','Sí se recomienda iniciar esquema de vacunación de 2 dosis.','La segunda dosis se aplica al menos 28 días después de la primera.');
        if(doses === '1') return makeResult('ok','Resultado','Sí se recomienda aplicar una dosis para completar esquema.','Acudir al centro de salud con cartilla/registro.');
        return makeResult('warn','Resultado','No es necesario vacunarse.','Conservar cartilla/registro.');
      }

      if(age === '6_11m'){
        if(doses === '0'){
          if(o === 'yes' || o === 'unsure') return makeResult('ok','Resultado','Sí se sugiere vacunación (dosis cero).','Acudir al centro de salud para valoración y aplicación según recomendación vigente.');
          return makeResult('warn','Resultado','En general no se recomienda dosis cero fuera de brote/campaña.','Acudir al centro de salud si existe indicación especial o duda.');
        }
        if(state.before12 === 'yes'){
          return makeResult('warn','Resultado','No se recomienda aplicar otra dosis ahora.','Se recomienda iniciar/continuar el esquema a partir de los 12 meses, según indicación del centro de salud.');
        }
        return makeResult('warn','Resultado','Se recomienda acudir al centro de salud con la cartilla/registro.','El personal de salud confirmará si corresponde dosis cero en este momento.');
      }

      if(age === '12_17m'){
        if(doses === '0') return makeResult('ok','Resultado','Sí se recomienda iniciar esquema de vacunación en cuanto sea posible.','Acudir al centro de salud con cartilla/registro.');
        if(doses === '1'){
          if(state.before12 === 'yes') return makeResult('ok','Resultado','Sí se recomienda vacunación ahora (inicio del esquema formal).','Deben pasar al menos 28 días entre dosis.');
          if(state.before12 === 'no') return makeResult('warn','Resultado','No se recomienda aplicar otra dosis ahora.','Acudir al centro de salud para confirmar cuándo corresponde la siguiente dosis según el esquema por edad.');
          return makeResult('warn','Resultado','Se recomienda acudir al centro de salud con cartilla/registro.','Se evaluará si la dosis fue antes o después de 12 meses y si corresponde una dosis en este momento.');
        }
        return makeResult('warn','Resultado','En general no se recomienda aplicar otra dosis ahora.','Consulta con profesionales de la salud si existen dudas sobre fechas o registros.');
      }

      if(age === '18m_9y'){
        if(doses === '0') return makeResult('ok','Resultado','Sí se recomienda iniciar esquema de vacunación en cuanto sea posible.','Acudir al centro de salud con cartilla/registro.');
        if(doses === '1') return makeResult('ok','Resultado','Sí se recomienda completar esquema con una dosis más.','Acudir al centro de salud con cartilla/registro.');
        if(o === 'yes' || o === 'unsure'){
          return makeResult('warn','Resultado','No es necesario vacunarse; se considera esquema completo.','En brote/campaña, el personal de salud puede indicar acciones de intensificación según la estrategia local.');
        }
        return makeResult('warn','Resultado','No es necesario vacunarse; se considera esquema completo.','Acudir al centro de salud si existen dudas sobre el registro.');
      }

      return makeResult('warn','Resultado','Información insuficiente.','Reiniciar y completar la evaluación.');
    }

    function goToResult(){
      const res = computeResult();
      applyResult(res);
      showScreen('screen-result','push');
    }

    // Flow buttons
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if(!btn) return;

      const next = btn.getAttribute('data-next');
      if(next){
        showScreen(next,'push');
        return;
      }

      const ans = btn.getAttribute('data-answer');
      const val = btn.getAttribute('data-value');
      if(!ans) return;

      if(ans === 'confirmed'){
        state.confirmed = (val === 'yes') ? 'yes' : 'no_unsure';
        if(state.confirmed === 'yes'){
          state.outbreak = null; state.age = null; state.evidence = null; state.doses = null; state.before12 = null; state.before12Context = null;
          goToResult();
        } else {
          showScreen('screen-outbreak','push');
        }
        return;
      }

      if(ans === 'outbreak'){
        state.outbreak = val;
        showScreen('screen-age','push');
        return;
      }

      if(ans === 'age'){
        state.age = val;
        state.evidence = null; state.doses = null; state.before12 = null; state.before12Context = null;
        showScreen('screen-evidence','push');
        return;
      }

      if(ans === 'evidence'){
        state.evidence = (val === 'yes') ? 'yes' : 'no_unsure';
        state.doses = null; state.before12 = null; state.before12Context = null;
        if(state.evidence === 'no_unsure') goToResult();
        else showScreen('screen-doses','push');
        return;
      }

      if(ans === 'doses'){
        state.doses = val;
        state.before12 = null; state.before12Context = null;

        if(state.age === '6_11m' && (val === '1' || val === '2p')){
          state.before12Context = '6_11m';
          before12Prompt.textContent = 'Esa dosis registrada, ¿se aplicó antes de cumplir 12 meses?';
          showScreen('screen-before12','push');
          return;
        }

        if(state.age === '12_17m' && val === '1'){
          state.before12Context = '12_17m';
          before12Prompt.textContent = 'Esa dosis registrada, ¿se aplicó antes de cumplir 12 meses?';
          showScreen('screen-before12','push');
          return;
        }

        goToResult();
        return;
      }

      if(ans === 'before12'){
        state.before12 = val;
        goToResult();
      }
    });

    // Nav buttons
    btnBack.addEventListener('click', (e) => {
      e.preventDefault();
      if(navStack.length <= 1) return;
      navStack.pop();
      const prev = navStack[navStack.length - 1];
      showScreen(prev,'replace');
    });

    btnHome.addEventListener('click', (e) => {
      e.preventDefault();
      resetState();
      navStack.length = 0;
      showScreen('screen-intro','push');
    });

    btnRestart.addEventListener('click', (e) => {
      e.preventDefault();
      hardRestart();
    });

    // Exit button (disclaimer)
    const btnExit = document.getElementById('btnExit');
    if(btnExit){
      btnExit.addEventListener('click', (e) => {
        e.preventDefault();
        window.close();
        setTimeout(() => {
          window.location.href = 'about:blank';
        }, 60);
      });
    }

    // Minimal "tests" (dev sanity checks)
    function assert(cond, msg){
      if(!cond){
        console.error('[measles-tool] Test failed:', msg);
        throw new Error(msg);
      }
    }

    function runTests(){
      assert(getScreen('screen-disclaimer'), 'Missing screen-disclaimer');
      assert(getScreen('screen-intro'), 'Missing screen-intro');
      assert(btnBack && btnHome && btnRestart, 'Missing nav buttons');
      assert(progressBar && stepLabel && stepHint, 'Missing progress elements');
      assert(resultTitle && resultPrimary && resultSecondary, 'Missing result elements');
      console.info('[measles-tool] Basic DOM tests passed');
    }

    runTests();
    hardRestart();
  })();
  </script>
</body>
</html>
