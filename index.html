<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guía orientativa para vacunación contra sarampióne epidemias - México</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121c33; --muted:#9fb0d0; --text:#e8efff;
      --accent:#6aa8ff; --warn:#ffcc66; --ok:#6ee7b7; --bad:#fb7185;
      --border:rgba(255,255,255,.10);
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#081022,#0b1220 50%,#071226);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:28px 16px 40px}
    h1{font-size:22px;margin:0 0 10px;letter-spacing:.2px}
    p{color:var(--muted);margin:6px 0 14px;line-height:1.4}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:rgba(18,28,51,.92);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 12px 30px rgba(0,0,0,.25)}
    .row{display:grid;grid-template-columns:1fr;gap:10px;margin:10px 0}
    @media(min-width:600px){.row.two{grid-template-columns:1fr 1fr}}
    label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
    input, select{width:100%;box-sizing:border-box;padding:10px 10px;border-radius:10px;border:1px solid var(--border);background:#0b1530;color:var(--text);outline:none}
    input:focus, select:focus{border-color:rgba(106,168,255,.75);box-shadow:0 0 0 3px rgba(106,168,255,.15)}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    button{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#132144;color:var(--text);cursor:pointer}
    button.primary{background:linear-gradient(135deg,#2b6cff,#6aa8ff);border-color:rgba(255,255,255,.15);color:#071226;font-weight:700}
    button:active{transform:translateY(1px)}

    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(11,21,48,.75);font-size:12px;color:var(--muted)}
    .pill b{color:var(--text)}

    .result{margin-top:10px;border-radius:14px;border:1px solid var(--border);background:rgba(11,21,48,.65);padding:14px}
    .result h2{font-size:16px;margin:0 0 8px}
    .kpi{display:flex;flex-wrap:wrap;gap:10px;margin:8px 0 0}
    .kpi .pill{background:rgba(18,28,51,.8)}

    .callout{border-left:4px solid var(--accent);padding:10px 12px;border-radius:10px;background:rgba(106,168,255,.08);color:var(--text)}
    .callout small{display:block;color:var(--muted);margin-top:6px;line-height:1.35}

    .tag{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);margin-right:8px}
    .tag.ok{background:rgba(110,231,183,.10);color:var(--ok);border-color:rgba(110,231,183,.25)}
    .tag.warn{background:rgba(255,204,102,.10);color:var(--warn);border-color:rgba(255,204,102,.25)}
    .tag.bad{background:rgba(251,113,133,.10);color:var(--bad);border-color:rgba(251,113,133,.25)}

    .hide{display:none}
    .footer{margin-top:14px;color:var(--muted);font-size:12px;line-height:1.35}

        /* Disclaimer overlay */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.62);display:flex;align-items:center;justify-content:center;padding:18px;z-index:9999}
    .modal{max-width:820px;width:100%;background:rgba(18,28,51,.98);border:1px solid var(--border);border-radius:16px;box-shadow:0 18px 60px rgba(0,0,0,.45);padding:16px}
    .modal h2{margin:0 0 8px;font-size:18px}
    .modal p{margin:8px 0;color:var(--muted)}
  </style>
</head>
<body>

  <!-- Disclaimer / gate -->
    <div class="overlay" id="disclaimerOverlay" aria-modal="true" role="dialog">
    <div class="modal">
      <h2>Aviso importante</h2>
      <p>Esta herramienta es una <b>guía orientativa</b>. <b>No es consejo médico</b> y no sustituye la valoración clínica.</p>
      <p>La situación epidemiológica y las recomendaciones <b>pueden cambiar</b>. Debes seguir <b>protocolos locales</b> y las indicaciones de <b>profesionales de la salud</b>. Úsalo solo como apoyo para la toma de decisiones.</p>
      <p>Si hay <b>inmunosupresión</b>, <b>embarazo</b>, <b>exposición reciente</b> o <b>brote institucional</b>, consulta con profesionales de la salud.</p>

      <div class="btns" style="justify-content:flex-end;">
        <button id="enter" class="primary">Entendido, continuar</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <h1>Guía orientativa para vacunación contra sarampión</h1>
    <p>Ingresa el <b>mes y año de nacimiento</b> y (cuando aplica) el antecedente de sarampión y número de dosis recibidas en la vida, para obtener una orientación más clara.</p>

    <div class="grid">
      <div class="card">
        <h2 style="font-size:16px;margin:0 0 8px;">Datos de entrada</h2>

        <div class="row two">
          <div>
            <label for="dobMonth">Mes y año de nacimiento (mm/aaaa)</label>
            <input id="dobMonth" type="month" />
          </div>
          <div>
            <label for="doses">Dosis de vacuna SRP/SR recibidas en la vida (si se conoce)</label>
            <select id="doses">
              <option value="unknown" selected>No sé</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2 (o más)</option>
            </select>
          </div>
        </div>

        <div class="row two" id="adultQuestions">
          <div>
            <label for="measles">¿Le ha dado sarampión alguna vez en la vida?</label>
            <select id="measles">
              <option value="no" selected>No</option>
              <option value="yes">Sí</option>
              <option value="unknown">No sé</option>
            </select>
          </div>
          <div>
            <label for="context">Contexto</label>
            <select id="context" disabled>
              <option value="outbreak" selected>Se asume brote/epidemia (dosis cero 6–11 meses)</option>
            </select>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="calc">Calcular recomendación</button>
          <button id="reset">Reiniciar</button>
        </div>

        <div class="footer">
          Nota: Esto es una <b>guía orientativa</b> (no sustituye valoración clínica ni las recomendaciones locales oficiales). Si hay inmunosupresión, embarazo/lactancia, exposición reciente, menor de 6 meses o brote institucional, consulte con un profesional de la salud.
        </div>
      </div>

      <div class="card">
        <h2 style="font-size:16px;margin:0 0 8px;">Resultado</h2>

        <div class="result" id="result">
          <div class="callout">
            Ingresa el <b>mes/año de nacimiento</b> y presiona <b>Calcular recomendación</b>.
            <small>Se calculará la edad aproximada en años/meses y se emitirá la conducta sugerida.</small>
          </div>
        </div>

        <div class="kpi" id="kpi" aria-live="polite"></div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  // --- Date helpers for month-only DOB ---
  function parseMonth(v){
    // v like "YYYY-MM"
    if(!v) return null;
    const parts = v.split('-');
    if(parts.length !== 2) return null;
    const y = Number(parts[0]);
    const m = Number(parts[1]);
    if(!Number.isFinite(y) || !Number.isFinite(m) || m < 1 || m > 12) return null;
    return new Date(Date.UTC(y, m-1, 1)); // first day of that month
  }

  function fmtMonthYear(d){
    const mm = String(d.getUTCMonth()+1).padStart(2,'0');
    const yy = d.getUTCFullYear();
    return `${mm}/${yy}`;
  }

  function ageFromMonth(dob, now){
    // dob and now are JS Dates; dob treated as first day of month
    let years = now.getFullYear() - dob.getUTCFullYear();
    let months = now.getMonth() - dob.getUTCMonth();
    if(months < 0){
      years -= 1;
      months += 12;
    }
    // If current date is before day 1? never; dob is day 1. No day correction needed.
    return {years, months};
  }

  function tagHTML(kind, text){
    const cls = kind === 'ok' ? 'ok' : (kind === 'warn' ? 'warn' : 'bad');
    return `<span class="tag ${cls}">${text}</span>`;
  }

  function setKPI(dob, now, age){
    $('kpi').innerHTML = `
      <span class="pill"><b>Edad:</b> ${age.years} años ${age.months} meses</span>
      <span class="pill"><b>Nac:</b> ${fmtMonthYear(dob)}</span>
      <span class="pill"><b>Hoy:</b> ${String(now.getMonth()+1).padStart(2,'0')}/${now.getFullYear()}</span>
    `;
  }

  // --- Core recommendations (requested wording: no exact dates, no "hoy") ---
  function recommend(){
    const now = new Date();
    const dob = parseMonth($('dobMonth').value);
    const measles = $('measles').value;
    const doses = $('doses').value;

    if(!dob){
      $('result').innerHTML = `<div class="callout">${tagHTML('bad','Falta dato')} Ingresa un <b>mes/año</b> válido.</div>`;
      $('kpi').innerHTML = '';
      return;
    }

    // If DOB is in future month
    const monthStartNow = new Date(Date.UTC(now.getFullYear(), now.getMonth(), 1));
    if(dob.getTime() > monthStartNow.getTime()){
      $('result').innerHTML = `<div class="callout">${tagHTML('bad','Dato inválido')} El mes/año de nacimiento no puede ser posterior al mes actual.</div>`;
      $('kpi').innerHTML = '';
      return;
    }

    const age = ageFromMonth(dob, now);
    setKPI(dob, now, age);

    const years = age.years;
    const monthsTotal = years*12 + age.months;

    // Threshold updated: born before 1957 presumed immune in this tool
    const birthYear = dob.getUTCFullYear();
    if(birthYear < 1957){
      $('result').innerHTML = `
        <div class="callout">
          ${tagHTML('ok','No vacunar')}
          <b>Nacido/a antes de 1957</b>: en esta guía se asume inmunidad por infección natural en la infancia. No se indica vacuna.
          <small>Si hay <b>brotes institucionales</b>, <b>inmunosupresión</b>, o <b>protocolos específicos</b>, confirma con autoridades locales o con su médico.</small>
        </div>
      `;
      return;
    }

    // < 6 months
    if(monthsTotal < 6){
      $('result').innerHTML = `
        <div class="callout">
          ${tagHTML('warn','Aún no corresponde')}
          <b>Menor de 6 meses</b>: se sugiere aplicar dosis cero al cumplir seis meses de edad.
          <small>Si hay exposición, inmunosupresión, embarazo (madre), lactancia, síntomas o brote institucional, consultar con profesionales de la salud.</small>
        </div>
      `;
      return;
    }

    // 6–11 months: assume outbreak => dose 0
    if(monthsTotal >= 6 && monthsTotal <= 11){
      $('result').innerHTML = `
        <div class="callout">
          ${tagHTML('warn','Vacunar')}
          <b>Edad 6–11 meses (durante epidemias)</b>: aplicar <b>dosis cero</b> lo más pronto posible (no cuenta como parte del esquema estándar de vacuanción).
          <div style="margin-top:10px;">
            <b>Después:</b>
            <ul style="margin:8px 0 0 18px;color:var(--text);">
              <li><b>Dosis 1</b> (esquema): al cumplir <b>12 meses</b>, respetando intervalo mínimo de <b>28 días</b> desde la dosis cero.</li>
              <li><b>Dosis 2</b>: al cumplir los <b>18 meses</b>.</li>
            </ul>
          </div>
          <small>Si hay inmunosupresión, lactancia, exposición reciente, síntomas o brote institucional, consultar con profesionales de la salud.</small>
        </div>
      `;
      return;
    }

    // Pediatric rule for 12 months to 9 years (direct to recommendation; consider vaccination status)
    const cutoff = new Date(Date.UTC(2020, 6, 1)); // 2020-07-01
    const bornAfterCutoff = dob.getTime() >= cutoff.getTime();

    if(monthsTotal >= 12 && years <= 9){
      // 12m–9y: "vacunarse"; operationally you either start or complete
      // Requested rule:
      // Dose 1 at 12 months (or now if not vaccinated).
      // Dose 2 at 18 months if born >= July 2020; or at 6 years if born before July 2020.

      // We keep dose-count logic for practical start/complete.
      let header = `${tagHTML('warn','Vacunar')} <b>Edad 12 meses a 9 años</b>: completar esquema de vacunación de dos dosis.`;

      let rec = '';
      const dose2Target = bornAfterCutoff ? 'a los <b>18 meses</b>' : 'o a los <b>6 años cumplidos</b>';

      if(doses === '2'){
        rec = `
          ${tagHTML('ok','No vacunar')}
          Reporta <b>2 dosis</b>: esquema completo.
          <small>Si hay duda documental o un protocolo específico distinto, confirmar con autoridades locales o con su médico.</small>
        `;
      } else if(doses === '1'){
        rec = `
          ${tagHTML('warn','Vacunar')}
          Reporta <b>1 dosis</b>: aplicar <b>una dosis</b> lo más pronto posible para completar 2 dosis a lo largo de la vida.
          <small>En esta guía, la segunda dosis corresponde ${dose2Target} (según mes/año de nacimiento), pero en epidemia se puede aplicar cuando falta para completar.</small>
        `;
      } else if(doses === '0'){
        rec = `
          ${tagHTML('warn','Vacunar')}
          Reporta <b>0 dosis</b>: 
          <ul style="margin:8px 0 0 18px;color:var(--text);">
            <li><b>Dosis 1</b>: lo más pronto posible.</li>
            <li><b>Dosis 2</b>: cuando corresponda por edad (${dose2Target}) o con intervalo mínimo de <b>4 semanas</b> entre dosis.</li>
          </ul>
        `;
      } else {
        rec = `
          ${tagHTML('warn','Vacunar')}
          <b>No se conoce</b> el número de dosis: en epidemia, si no hay evidencia documental confiable, completar esquema.
          <small>En general: aplicar las dosis faltantes en cuanto sea posible (dosis y/o refuerzo según edad y recomendaciones locales).</small>
        `;
      }

      $('result').innerHTML = `
        <div class="callout">
          ${header}
          <div style="margin-top:10px;">
            <b>Regla pediátrica:</b>
            <ul style="margin:8px 0 0 18px;color:var(--text);">
              <li><b>Dosis 1</b>: a los <b>12 meses</b> (o lo más pronto posible si no se ha vacunado).</li>
              <li><b>Dosis 2</b>: a los <b>18 meses</b> si nació a partir de <b>julio 2020</b>, o a los <b>6 años</b> si nació antes de <b>julio 2020</b>.</li>
            </ul>
          </div>
          <div style="margin-top:10px;">${rec}</div>
        </div>
      `;
      return;
    }

    // 10–49 years (align with IMSS style: if no documentation => 2 doses 4 weeks apart; if 1 prior => 1 dose)
    if(years >= 10 && years <= 49){
      // If measles yes OR doses==2 => no vaccine
      if(measles === 'yes' || doses === '2'){
        $('result').innerHTML = `
          <div class="callout">
            ${tagHTML('ok','No vacunar')}
            <b>Edad 10–49 años</b>: si ya tuvo sarampión o cuenta con <b>2 dosis</b> documentadas, no se indica vacunación.
            <small>Si hay brotes institucionales, inmunosupresión, embaraazo/lactancia, síntomas, exposición reciente o protocolos específicos, consultar con autoridades locales o con su médico.</small>
          </div>
        `;
        return;
      }

      const caution = (measles === 'unknown')
        ? `<small>${tagHTML('warn','Dato incierto')} No se conoce antecedente de sarampión: si no hay evidencia de infección previa, se maneja como <b>no</b>.</small>`
        : '';

      if(doses === '1'){
        $('result').innerHTML = `
          <div class="callout">
            ${tagHTML('warn','Vacunar')}
            <b>Edad 10–49 años</b>, <b>1 dosis</b> y sin antecedente de sarampión: aplicar <b>1 dosis</b> lo más pronto posible para completar su esquema.
            ${caution}
          </div>
        `;
        return;
      }

      // 0 or unknown doses, no measles => 2 doses 4 weeks apart
      $('result').innerHTML = `
        <div class="callout">
          ${tagHTML('warn','Vacunar')}
          <b>Edad 10–49 años</b> y sin antecedente de sarampión: aplicar <b>2 dosis</b> separadas por <b>28 días</b> (captación) cuando no hay esquema completo documentado.
          <div style="margin-top:10px;">
            <ul style="margin:8px 0 0 18px;color:var(--text);">
              <li><b>Dosis 1</b>: lo más pronto posible.</li>
              <li><b>Dosis 2</b>: <b>4 semanas</b> después.</li>
            </ul>
          </div>
          ${caution}
          <small>Si hay brotes institucionales, inmunosupresión, embaraazo/lactancia, síntomas, exposición reciente o protocolos específicos, confirmar con autoridades locales o con su médico.</small>
        </div>
      `;
      return;
    }

    // >= 50 years fallback (many will be <1957 already handled)
    $('result').innerHTML = `
      <div class="callout">
        ${tagHTML('ok','No vacunar')}
        <b>≥ 50 años</b>: frecuentemente hay inmunidad por exposición/infección previa, pero la conducta puede depender de lineamientos locales o recomendaciones médicas.
        <small>Si hay brotes institucionales, inmunosupresión, síntomas, exposición reciente o protocolos específicos, confirmar con autoridades locales o con su médico.</small>
      </div>
    `;
  }

  // UI: show adult questions only for >=10y
  function updateQuestionsVisibility(){
    const dob = parseMonth($('dobMonth').value);
    if(!dob){
      $('adultQuestions').classList.remove('hide');
      return;
    }
    const now = new Date();
    const age = ageFromMonth(dob, now);
    if(age.years < 10) $('adultQuestions').classList.add('hide');
    else $('adultQuestions').classList.remove('hide');
  }

    // Disclaimer gating (robusto: funciona aun si localStorage está bloqueado)
  function safeGet(key){
    try{ return window.localStorage ? localStorage.getItem(key) : null; }catch(e){ return null; }
  }
  function safeSet(key, val){
    try{ if(window.localStorage) localStorage.setItem(key, val); }catch(e){ /* ignorar */ }
  }

  function initDisclaimer(){
    const accepted = safeGet('measles_tool_disclaimer_accepted');
    if(accepted === 'yes'){
      $('disclaimerOverlay').classList.add('hide');
      return;
    }
    $('disclaimerOverlay').classList.remove('hide');
  }

  $('enter').addEventListener('click', (e) => {
    e.preventDefault();
    // Guardar preferencia si se puede, pero siempre dejar continuar
    safeSet('measles_tool_disclaimer_accepted', 'yes');
    $('disclaimerOverlay').classList.add('hide');
  });
    // Guardar preferencia si se puede, pero siempre dejar continuar
    safeSet('measles_tool_disclaimer_accepted', 'yes');
    $('disclaimerOverlay').classList.add('hide');
  });

  $('calc').addEventListener('click', recommend);
  $('reset').addEventListener('click', () => {
    $('dobMonth').value = '';
    $('measles').value = 'no';
    $('doses').value = 'unknown';
    $('kpi').innerHTML = '';
    $('result').innerHTML = `
      <div class="callout">
        Ingresa el <b>mes/año de nacimiento</b> y presiona <b>Calcular recomendación</b>.
        <small>Se calculará la edad aproximada en años/meses y se emitirá la conducta sugerida.</small>
      </div>
    `;
    updateQuestionsVisibility();
  });

  $('dobMonth').addEventListener('change', updateQuestionsVisibility);

  updateQuestionsVisibility();
  initDisclaimer();
</script>
</body>
</html>
